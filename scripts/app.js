!function(e){function t(i){if(r[i])return r[i].exports;var n=r[i]={exports:{},id:i,loaded:!1};return e[i].call(n.exports,n,n.exports,t),n.loaded=!0,n.exports}var r={};return t.m=e,t.c=r,t.p="",t(0)}([function(e,t,r){e.exports=r(1)},function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var a=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),o=r(2),s=i(o),u=r(6),f=r(7),l=new Event("maskedPointsReady"),c=window.devicePixelRatio||1,d=void 0,h=void 0,m=void 0,p=void 0,v=void 0,g=null,w=function(){function e(t){n(this,e),d=this,h=t,m=h.canvas;var r=h.mouseListenerContainer||m;if(h.canvas=null,h.mouseListenerContainer=null,g=u(m),!g)return void console.warn("Error at Masked Points: Unable to initialize WebGL. Your browser may not support it.");this._initGlState();var i=new f;i.addEventListener("error",function(e){console.warn("Error in webworker: ",e.data)},!1),i.addEventListener("message",function(e){e.data.geometries&&(d.points=new s.default(g,r,e.data.geometries,h),document.dispatchEvent(l))},!1),i.postMessage(h)}return a(e,[{key:"_initGlState",value:function(){var e=h.backgroundColor;g.clearColor(e[0],e[1],e[2],1),g.enable(g.BLEND),g.blendFunc(g.ONE,g.ONE)}},{key:"_resize",value:function(){p=Math.floor(m.clientWidth*c),v=Math.floor(m.clientHeight*c),m.width===p&&m.height===v||(m.width=p,m.height=v,this.points&&this.points.resize()),g.viewport(0,0,g.canvas.width,g.canvas.height)}},{key:"render",value:function(){d._resize(),g.clear(g.COLOR_BUFFER_BIT|g.DEPTH_BUFFER_BIT),d.points&&d.points.render()}},{key:"updateCamera",value:function(e){d.points&&d.points.updateCamera(e)}},{key:"setBlendStates",value:function(e,t){d.points.setPositionIndices(e,t)}},{key:"updateBlendProgress",value:function(e){d.points&&d.points.updateProgress(e)}}]),e}();window.maskedPoints={},window.maskedPoints.init=function(e){return new w(e)}},function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),o=r(3),s=i(o),u=r(4),f=i(u),l=r(5),c=void 0,d=void 0,h=void 0,m=0,p=0,v=0,g=0,w=0,M=void 0,b=void 0,x=void 0,y=void 0,A=!0,P=1,R=void 0,B=void 0,k=function(){function e(t,r,i,a){var o=this;n(this,e),this.gl=t,this.n=a.pointsCount||1,this.camSpeed=a.camera.speed||0,this.camAmplitude=a.camera.amplitude||0,this.camNear=a.camera.near||1,this.camFar=a.camera.far||80,this.camFovY=a.camera.fovy||1,this.camInertiaMult=a.camera.inertiaMult||1,this.positions=i,R=t.createBuffer(),B=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,R),t.bufferData(t.ARRAY_BUFFER,this.positions[0],t.STATIC_DRAW),t.bindBuffer(t.ARRAY_BUFFER,B),t.bufferData(t.ARRAY_BUFFER,this.positions[0],t.STATIC_DRAW),t.bindBuffer(t.ARRAY_BUFFER,null),this.shaderProgram=this.createShaderProgram(t);var s=t.getAttribLocation(this.shaderProgram,"position"),u=t.getAttribLocation(this.shaderProgram,"newPosition");t.bindBuffer(t.ARRAY_BUFFER,R),t.vertexAttribPointer(s,3,t.FLOAT,!1,0,0),t.enableVertexAttribArray(s),t.bindBuffer(t.ARRAY_BUFFER,B),t.vertexAttribPointer(u,3,t.FLOAT,!1,0,0),t.enableVertexAttribArray(u),this.viewMatrix=(0,l.createMatrix4)(),this.perpectiveMatrix=(0,l.createMatrix4)(),this.viewPerspectiveMatrix=(0,l.createMatrix4)(),this.eyePos=[0,0,0],this.eyeTargetPos=[0,0,-a.camera.targetDistance],this.up=[0,1,0],c=this.gl.getUniformLocation(this.shaderProgram,"viewPerspectiveMatrix"),d=this.gl.getUniformLocation(this.shaderProgram,"progress"),t.useProgram(this.shaderProgram);var f=this.gl.getUniformLocation(this.shaderProgram,"pointSizeMinMax");t.uniform2f(f,a.pointSizeMinMax[0],a.pointSizeMinMax[1]);var h=this.gl.getUniformLocation(this.shaderProgram,"pointSizeDistMinMax");t.uniform2f(h,a.pointSizeDistMinMax[0],a.pointSizeDistMinMax[1]);var m=this.gl.getUniformLocation(this.shaderProgram,"color");t.uniform3f(m,a.pointsColor[0],a.pointsColor[1],a.pointsColor[2]),this.resize(),this.updateCamera(0),a.camera.speed&&(r.addEventListener("mousemove",function(e){p=(e.clientX/window.innerWidth-.5)*o.camAmplitude,v=-(e.clientY/window.innerHeight-.5)*o.camAmplitude}),r.addEventListener("touchmove",function(e){e.changedTouches&&e.changedTouches[0]&&(p=(e.changedTouches[0].clientX/window.innerWidth-.5)*o.camAmplitude,v=-(e.changedTouches[0].clientY/window.innerHeight-.5)*o.camAmplitude)}),r.addEventListener("mouseout",function(){A=!1}),r.addEventListener("mouseleave",function(){A=!1}),r.addEventListener("mouseenter",function(){A=!0,P=1}))}return a(e,[{key:"setPositionIndices",value:function(e,t){var r=e,i=t,n=this.gl;this.positions[r]&&this.positions[i]||(r=0,i=0),n.bindBuffer(n.ARRAY_BUFFER,R),n.bufferData(n.ARRAY_BUFFER,this.positions[r],n.STATIC_DRAW),n.bindBuffer(n.ARRAY_BUFFER,B),n.bufferData(n.ARRAY_BUFFER,this.positions[i],n.STATIC_DRAW),n.bindBuffer(n.ARRAY_BUFFER,null)}},{key:"resize",value:function(){(0,l.makePerspectiveMatrix)(this.perpectiveMatrix,this.camFovY,window.innerWidth/window.innerHeight,this.camNear,this.camFar)}},{key:"updateCamera",value:function(e){h=e-m,m=e,!isNaN(h)&&h<1&&(M=p-g,b=v-w,(Math.abs(M)>.005||Math.abs(b)>.005)&&(x=Math.sqrt(M*M+b*b),M/=x,b/=x,y=Math.min(3*x,1),g+=M*h*this.camSpeed*y*P,w+=b*h*this.camSpeed*y*P),A||(P=Math.max(0,P-h*this.camInertiaMult)),this.eyePos[0]=g,this.eyePos[1]=w,(0,l.lookAt)(this.viewMatrix,this.eyePos,this.eyeTargetPos,this.up),(0,l.multiplyMatrices)(this.viewPerspectiveMatrix,this.perpectiveMatrix,this.viewMatrix),this.gl.uniformMatrix4fv(c,!1,this.viewPerspectiveMatrix))}},{key:"createShaderProgram",value:function(e){var t=e.createShader(e.VERTEX_SHADER);e.shaderSource(t,s.default),e.compileShader(t);var r=e.createShader(e.FRAGMENT_SHADER);e.shaderSource(r,f.default),e.compileShader(r);var i=e.createProgram();return e.attachShader(i,t),e.attachShader(i,r),e.linkProgram(i),i}},{key:"updateProgress",value:function(e){this.gl.uniform1f(d,e)}},{key:"render",value:function(){this.gl.drawArrays(this.gl.POINTS,0,this.n)}}]),e}();t.default=k},function(e,t){e.exports="attribute vec3 position;\nattribute vec3 newPosition;\n\nuniform mat4 viewPerspectiveMatrix;\n\nuniform vec2 pointSizeMinMax;\nuniform vec2 pointSizeDistMinMax;\nuniform float progress;\n\nvarying float dist;\n\nvoid main() {\n    vec3 pos = mix(position, newPosition, progress);\n    dist = clamp((-pos.z - pointSizeDistMinMax.x) / pointSizeDistMinMax.y, 0., 1.);\n\n    gl_Position = viewPerspectiveMatrix * vec4(pos, 1.0);\n    gl_PointSize = mix(pointSizeMinMax.y, pointSizeMinMax.x, dist);\n}\n"},function(e,t){e.exports="precision highp float;\n\nuniform vec3 color;\nvarying float dist;\n\nvoid main() {\n\n    vec2 coord = gl_PointCoord - vec2(0.5);\n    float inCircle = 1. - smoothstep(0.495, 0.500, length(coord));\n    // if (length(coord) > 0.5) inCircle = 0.;\n\n    if (inCircle < 0.95) discard;\n    gl_FragColor.rgb = vec3(mix(0., 1. - dist, inCircle)) * color;\n\n    gl_FragColor.a = mix(1., 1. - dist, inCircle);\n}\n"},function(e,t){"use strict";function r(){var e=new Float32Array(16);return s(e),e}function i(e,t,r,i){var n=void 0,a=void 0,u=void 0,f=void 0,l=void 0,c=void 0,d=void 0,h=void 0,m=void 0,p=void 0,v=t[0],g=t[1],w=t[2],M=i[0],b=i[1],x=i[2],y=r[0],A=r[1],P=r[2];return Math.abs(v-y)<o&&Math.abs(g-A)<o&&Math.abs(w-P)<o?s(e):(d=v-y,h=g-A,m=w-P,p=1/Math.sqrt(d*d+h*h+m*m),d*=p,h*=p,m*=p,n=b*m-x*h,a=x*d-M*m,u=M*h-b*d,p=Math.sqrt(n*n+a*a+u*u),p?(p=1/p,n*=p,a*=p,u*=p):(n=0,a=0,u=0),f=h*u-m*a,l=m*n-d*u,c=d*a-h*n,p=Math.sqrt(f*f+l*l+c*c),p?(p=1/p,f*=p,l*=p,c*=p):(f=0,l=0,c=0),e[0]=n,e[1]=f,e[2]=d,e[3]=0,e[4]=a,e[5]=l,e[6]=h,e[7]=0,e[8]=u,e[9]=c,e[10]=m,e[11]=0,e[12]=-(n*v+a*g+u*w),e[13]=-(f*v+l*g+c*w),e[14]=-(d*v+h*g+m*w),e[15]=1,e)}function n(e,t,r,i,n){var a=1/Math.tan(t/2),o=1/(i-n);return e[0]=a/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=a,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=(n+i)*o,e[11]=-1,e[12]=0,e[13]=0,e[14]=2*n*i*o,e[15]=0,e}function a(e,t,r){var i=t[0],n=t[1],a=t[2],o=t[3],s=t[4],u=t[5],f=t[6],l=t[7],c=t[8],d=t[9],h=t[10],m=t[11],p=t[12],v=t[13],g=t[14],w=t[15],M=r[0],b=r[1],x=r[2],y=r[3];return e[0]=M*i+b*s+x*c+y*p,e[1]=M*n+b*u+x*d+y*v,e[2]=M*a+b*f+x*h+y*g,e[3]=M*o+b*l+x*m+y*w,M=r[4],b=r[5],x=r[6],y=r[7],e[4]=M*i+b*s+x*c+y*p,e[5]=M*n+b*u+x*d+y*v,e[6]=M*a+b*f+x*h+y*g,e[7]=M*o+b*l+x*m+y*w,M=r[8],b=r[9],x=r[10],y=r[11],e[8]=M*i+b*s+x*c+y*p,e[9]=M*n+b*u+x*d+y*v,e[10]=M*a+b*f+x*h+y*g,e[11]=M*o+b*l+x*m+y*w,M=r[12],b=r[13],x=r[14],y=r[15],e[12]=M*i+b*s+x*c+y*p,e[13]=M*n+b*u+x*d+y*v,e[14]=M*a+b*f+x*h+y*g,e[15]=M*o+b*l+x*m+y*w,e}Object.defineProperty(t,"__esModule",{value:!0}),t.createMatrix4=r,t.lookAt=i,t.makePerspectiveMatrix=n,t.multiplyMatrices=a;var o=1e-6,s=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}},function(e,t){"use strict";e.exports=function(e){if(window.WebGLRenderingContext){for(var t=["webgl","experimental-webgl","moz-webgl"],r=!1,i=0;i<t.length;i++)try{if(r=e.getContext(t[i]),r&&"function"==typeof r.getParameter)return r}catch(e){console.log("Unable to initialize WebGL. Your browser may not support it.")}return!1}return!1}},function(e,t,r){e.exports=function(){return r(8)('!function(e){function t(a){if(r[a])return r[a].exports;var o=r[a]={exports:{},id:a,loaded:!1};return e[a].call(o.exports,o,o.exports,t),o.loaded=!0,o.exports}var r={};return t.m=e,t.c=r,t.p="",t(0)}([function(e,t,r){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}var o=r(1),n=a(o),s=r(2),i=a(s);self.imageParser=new n.default,self.posGenerator=new i.default,self.unprocessedStatesAmount=1,self.pointsCount=1,self.result={geometries:[]},self.exit=function(){for(var e=new Array(self.result.geometries.length),t=0;t<self.result.geometries.length;t++)e[t]=self.result.geometries[t].buffer;self.postMessage(self.result,e)},self.shuffleArray=function(e){var t=void 0,r=void 0,a=void 0;for(t=e.length-1;t>0;t-=1)r=e[t],a=Math.floor(Math.random()*(t+1)),e[t]=e[a],e[a]=r},self.addSectorsDataToImage=function(e){e.sectors=[];for(var t=0;t<e.data.length;t++)e.data[t]&&e.sectors.push(t);self.shuffleArray(e.sectors)},self.makeImageRequest=function(e,t){var r=new XMLHttpRequest;r.open("GET",e.imageUrl,!0),r.responseType="arraybuffer",r.onreadystatechange=function(){if(4===r.readyState&&200===r.status){var a=self.imageParser.parsePBMBinaryImage(r.response);self.addSectorsDataToImage(a),self.result.geometries[t]=self.posGenerator.generateMaskedBoxVertices(self.pointsCount,e,a),self.unprocessedStatesAmount-=1,self.unprocessedStatesAmount<1&&self.exit()}},r.send()},self.startCreation=function(e,t){self.pointsCount=t,self.unprocessedStatesAmount=0;for(var r=0;r<e.length;r++)switch(e[r].type){case"rawData":self.result.geometries[r]=new Float32Array(e[r].data);break;case"box":self.result.geometries[r]=self.posGenerator.generateBoxVertices(self.pointsCount,e[r]);break;case"maskedBoxFromImage":if(!e[r].imageUrl)throw new Error("Masked Points Transition: State with \'maskedBoxFromImage\' type should have \'imageUrl\' field");self.unprocessedStatesAmount+=1,self.makeImageRequest(e[r],r);break;case"maskedBoxFromMatrix":var a={data:e[r].matrix||[],width:e[r].matrixWidth||1,height:e[r].matrixHeight||1};self.addSectorsDataToImage(a),self.result.geometries[r]=self.posGenerator.generateMaskedBoxVertices(self.pointsCount,e[r],a);break;default:throw new Error("Masked Points Transition: Unknown points state type. Should be box / maskedBoxFromImage / maskedBoxFromMatrix / rawData.")}self.unprocessedStatesAmount<1&&self.exit()},self.addEventListener("message",function(e){e.data.states&&e.data.pointsCount&&self.startCreation(e.data.states,e.data.pointsCount)},!1),self.addEventListener("error",function(e){self.postMessage(e,"error in webworker")},!1)},function(e,t){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,r,a){return r&&e(t.prototype,r),a&&e(t,a),t}}(),o=function(){function e(){r(this,e)}return a(e,[{key:"parsePBMBinaryImage",value:function(e){var t=new Uint8Array(e),r=t.toString(),a=r.split(","),o=!1,n=!1,s=!1,i=!1,f=void 0,l=void 0;for(f=0;f<a.length;f++)if("10"===a[f])i=!1;else if(!i)if("35"===a[f])i=!0;else if(o){if(n)break;n=0,s=0;var u=void 0;for(l=0;"32"!==a[f];){if(u=parseInt(String.fromCharCode(a[f]),10),l>4||isNaN(u))throw new Error("Corrupted PBM image (image width / height data).");n=10*n+u,f++,l++}for("32"===a[f]&&f++,l=0;"10"!==a[f];){if(u=parseInt(String.fromCharCode(a[f]),10),l>4||isNaN(u))throw new Error("Corrupted PBM image (image width / height data).");s=10*s+u,f++,l++}}else{if("80"!==a[f]||"52"!==a[f+1])throw new Error("Wrong image format. Should be PBM binary (with P4 header).");o=!0,f++}var d=f,c=a.length-d,h=new Array(n*s),m=void 0,g=0,p=0;for(f=0;f<c;f++){g+=8;var v=parseInt(a[f+d],10);if(g<n)for(l=0;l<8;l++)h[p*n+g-l-1]=v%2,v=Math.floor(v/2);else{for(g-=8,m=n-g,l=0;l<8;l++)l>=8-m&&(h[p*n+g+8-l-1]=v%2),v=Math.floor(v/2);g=0,p++}}return{data:h,width:n,height:s}}}]),e}();t.default=o},function(e,t){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,r,a){return r&&e(t.prototype,r),a&&e(t,a),t}}(),o=function(){function e(){r(this,e)}return a(e,[{key:"generateBoxVertices",value:function(e,t){for(var r=t.width||10,a=t.height||10,o=t.depth||10,n=t.zDistance||5,s=new Array(3*e),i=0;i<3*e;i+=3)s[i]=Math.random()*r-r/2,s[i+1]=Math.random()*a-a/2,s[i+2]=-(Math.random()*o-o/2)-n;return new Float32Array(s)}},{key:"generateMaskedBoxVertices",value:function(e,t,r){for(var a=t.width||10,o=t.height||10,n=t.depth||10,s=t.zDistance||5,i=r.width,f=r.height,l=r.sectors,u=void 0,d=void 0,c=new Array(3*e),h=void 0,m=0;m<3*e;m+=3)h=m/3%l.length,d=1-(Math.floor(l[h]/i)+Math.random())/f,u=(l[h]%i+Math.random())/i,c[m]=u*a-a/2,c[m+1]=d*o-o/2,c[m+2]=-(Math.random()*n-n/2)-s;return new Float32Array(c)}}]),e}();t.default=o}]);',r.p+"9a4ae45f097a729f7e66.worker.js")}},function(e,t){var r=window.URL||window.webkitURL;e.exports=function(e,t){try{try{var i;try{var n=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder;i=new n,i.append(e),i=i.getBlob()}catch(t){i=new Blob([e])}return new Worker(r.createObjectURL(i))}catch(t){return new Worker("data:application/javascript,"+encodeURIComponent(e))}}catch(e){return new Worker(t)}}}]);