!function(e){function t(i){if(r[i])return r[i].exports;var n=r[i]={exports:{},id:i,loaded:!1};return e[i].call(n.exports,n,n.exports,t),n.loaded=!0,n.exports}var r={};return t.m=e,t.c=r,t.p="",t(0)}([function(e,t,r){e.exports=r(1)},function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var a=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),o=r(2),s=i(o),l=r(5),u=r(6),f=null,c=void 0,d=void 0,h=void 0,p=0,g=void 0,m=window.devicePixelRatio||1,v={pointsCount:1500,pointSizeMin:5,pointSizeMax:10,backgroundColor:[0,0,0,1],pointsColor:[1,1,1],states:[{type:"box",width:10,height:10,depth:10,zDistance:5},{type:"box",width:10,height:10,depth:10,zDistance:5},{type:"box",width:50,height:50,depth:1,zDistance:-1},{type:"maskedBoxFromImage",imageUrl:"https://mlknz.github.io/Masked-Points-Transition/assets/images/test4.pbm",width:10,height:10,depth:.1,zDistance:12},{type:"maskedBoxFromMatrix",matrix:[1,1,1,0,0,1,1,0,1],matrixWidth:3,matrixHeight:3,width:10,height:10,depth:.1,zDistance:12}]},w=function(){function e(){if(n(this,e),g=this,c=document.getElementById("canvas"),f=l(c),!f)return void(document.body.innerHTML="Unable to initialize WebGL. Your browser may not support it.");this.initGlState();var t=new u;t.addEventListener("error",function(e){console.warn("Error in webworker: ",e.data)},!1),t.addEventListener("message",function(e){e.data.geometries&&(g.points=new s.default(f,e.data.geometries,v),g.points.setPositionIndices(4,2))},!1),t.postMessage(v),this.animate()}return a(e,[{key:"initGlState",value:function(){var e=v.backgroundColor;f.clearColor(e[0],e[1],e[2],e[3]),f.enable(f.BLEND),f.blendFunc(f.ONE,f.ONE)}},{key:"resize",value:function(){d=Math.floor(c.clientWidth*m),h=Math.floor(c.clientHeight*m),c.width===d&&c.height===h||(c.width=d,c.height=h,this.points&&this.points.resize()),f.viewport(0,0,f.canvas.width,f.canvas.height)}},{key:"animate",value:function(){g.resize(),f.clear(f.COLOR_BUFFER_BIT|f.DEPTH_BUFFER_BIT),p=(new Date).getTime(),p=(p-1e6*Math.floor(p/1e6))/1e3,g.points&&(f.useProgram(g.points.shaderProgram),g.points.updateProgress(p),g.points.render()),requestAnimationFrame(g.animate)}}]),e}();window.app=new w},function(e,t,r){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),o=r(3),s=i(o),l=r(4),u=i(l),f=void 0,c=void 0,d=void 0,h=void 0,p=void 0,g=void 0,m=function(){function e(t,r,i){var a=this;n(this,e),this.gl=t,this.n=i.pointsCount,this.positions=r,p=t.createBuffer(),g=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,p),t.bufferData(t.ARRAY_BUFFER,this.positions[0],t.STATIC_DRAW),t.bindBuffer(t.ARRAY_BUFFER,g),t.bufferData(t.ARRAY_BUFFER,this.positions[0],t.STATIC_DRAW),t.bindBuffer(t.ARRAY_BUFFER,null),this.shaderProgram=this.createShaderProgram(t);var o=t.getAttribLocation(this.shaderProgram,"position"),s=t.getAttribLocation(this.shaderProgram,"newPosition");t.bindBuffer(t.ARRAY_BUFFER,p),t.vertexAttribPointer(o,3,t.FLOAT,!1,0,0),t.enableVertexAttribArray(o),t.bindBuffer(t.ARRAY_BUFFER,g),t.vertexAttribPointer(s,3,t.FLOAT,!1,0,0),t.enableVertexAttribArray(s),this.viewMatrix=mat4.create(),this.perpectiveMatrix=mat4.create(),this.viewPerspectiveMatrix=mat4.create(),this.eyePos=vec3.fromValues(0,0,0),this.eyeTargetPos=vec3.fromValues(0,0,-2),this.up=vec3.fromValues(0,1,0),d=this.gl.getUniformLocation(this.shaderProgram,"viewPerspectiveMatrix"),h=this.gl.getUniformLocation(this.shaderProgram,"progress"),t.useProgram(this.shaderProgram);var l=this.gl.getUniformLocation(this.shaderProgram,"pointSizeMinMax");this.gl.uniform2f(l,i.pointSizeMin,i.pointSizeMax);var u=this.gl.getUniformLocation(this.shaderProgram,"color");this.gl.uniform3f(u,i.pointsColor[0],i.pointsColor[1],i.pointsColor[2]),this.updateView({clientX:window.innerWidth/2,clientY:window.innerHeight/2}),this.resize(),document.addEventListener("mousemove",function(e){a.updateView(e)})}return a(e,[{key:"setPositionIndices",value:function(e,t){var r=e,i=t,n=this.gl;this.positions[r]&&this.positions[i]||(r=0,i=0),n.bindBuffer(n.ARRAY_BUFFER,p),n.bufferData(n.ARRAY_BUFFER,this.positions[r],n.STATIC_DRAW),n.bindBuffer(n.ARRAY_BUFFER,g),n.bufferData(n.ARRAY_BUFFER,this.positions[i],n.STATIC_DRAW),n.bindBuffer(n.ARRAY_BUFFER,null)}},{key:"resize",value:function(){this.gl.useProgram(this.shaderProgram),mat4.perspective(this.perpectiveMatrix,1,window.innerWidth/window.innerHeight,.5,21.1),mat4.multiply(this.viewPerspectiveMatrix,this.viewMatrix,this.perpectiveMatrix),this.gl.uniformMatrix4fv(d,!1,this.viewPerspectiveMatrix)}},{key:"updateView",value:function(e){f=e.clientX/window.innerWidth,c=e.clientY/window.innerHeight,this.eyePos[0]=.3*-(f-.5),this.eyePos[1]=.3*+(c-.5),mat4.lookAt(this.viewMatrix,this.eyePos,this.eyeTargetPos,this.up),mat4.multiply(this.viewPerspectiveMatrix,this.viewMatrix,this.perpectiveMatrix),this.gl.uniformMatrix4fv(d,!1,this.viewPerspectiveMatrix)}},{key:"createShaderProgram",value:function(e){var t=e.createShader(e.VERTEX_SHADER);e.shaderSource(t,s.default),e.compileShader(t);var r=e.createShader(e.FRAGMENT_SHADER);e.shaderSource(r,u.default),e.compileShader(r);var i=e.createProgram();return e.attachShader(i,t),e.attachShader(i,r),e.linkProgram(i),i}},{key:"updateProgress",value:function(e){this.gl.uniform1f(h,e)}},{key:"render",value:function(){this.gl.drawArrays(this.gl.POINTS,0,this.n)}}]),e}();t.default=m},function(e,t){e.exports="attribute vec3 position;\nattribute vec3 newPosition;\n\nuniform mat4 viewPerspectiveMatrix;\n\nuniform vec2 pointSizeMinMax;\nuniform float progress;\n\nvarying float dist;\n\nvoid main() {\n\n    vec3 pos = mix(position, newPosition, sin(progress)*0.5 + 0.5);\n    dist = (-pos.z - 1.) / 10.; // [0, 1]\n\n    gl_Position = viewPerspectiveMatrix * vec4(pos, 1.0);\n    gl_PointSize = mix(pointSizeMinMax.y, pointSizeMinMax.x, dist);\n}\n"},function(e,t){e.exports="precision highp float;\n\nuniform vec3 color;\nvarying float dist;\n\nvoid main() {\n\n    vec2 coord = gl_PointCoord - vec2(0.5);\n    float inCircle = 1. - smoothstep(0.495, 0.500, length(coord));\n    // if (length(coord) > 0.5) inCircle = 0.;\n    if (inCircle < 0.95) discard;\n    gl_FragColor = vec4(mix(0., 1. - dist, inCircle));\n\n    gl_FragColor.rgb *= color;\n    gl_FragColor.a = mix(1., 1. - dist, inCircle);\n}\n"},function(e,t){"use strict";e.exports=function(e){if(window.WebGLRenderingContext){for(var t=["webgl","experimental-webgl","moz-webgl"],r=!1,i=0;i<t.length;i++)try{if(r=e.getContext(t[i]),r&&"function"==typeof r.getParameter)return r}catch(e){console.log("Unable to initialize WebGL. Your browser may not support it.")}return!1}return!1}},function(e,t,r){e.exports=function(){return r(7)('!function(e){function t(a){if(r[a])return r[a].exports;var o=r[a]={exports:{},id:a,loaded:!1};return e[a].call(o.exports,o,o.exports,t),o.loaded=!0,o.exports}var r={};return t.m=e,t.c=r,t.p="",t(0)}([function(e,t,r){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}var o=r(1),n=a(o),s=r(2),i=a(s);self.imageParser=new n.default,self.posGenerator=new i.default,self.unprocessedStatesAmount=1,self.pointsCount=1,self.result={geometries:[]},self.exit=function(){for(var e=new Array(self.result.geometries.length),t=0;t<self.result.geometries.length;t++)e[t]=self.result.geometries[t].buffer;self.postMessage(self.result,e)},self.makeImageRequest=function(e,t){var r=new XMLHttpRequest;r.open("GET",e.imageUrl,!0),r.responseType="arraybuffer",r.onreadystatechange=function(){if(4===r.readyState&&200===r.status){var a=self.imageParser.parsePBMBinaryImage(r.response);a.sectors=[];for(var o=0;o<a.data.length;o++)a.data[o]&&a.sectors.push(o);var n=self.posGenerator.generateMaskedBoxVertices(self.pointsCount,e,a);self.result.geometries[t]=n,self.unprocessedStatesAmount-=1,self.unprocessedStatesAmount<1&&self.exit()}},r.send()},self.startCreation=function(e,t){self.pointsCount=t,self.unprocessedStatesAmount=0;for(var r=void 0,a=0;a<e.length;a++)switch(e[a].type){case"rawData":self.result.geometries[a]=new Float32Array(e[a].data);break;case"box":r=self.posGenerator.generateBoxVertices(self.pointsCount,e[a]),self.result.geometries[a]=r;break;case"maskedBoxFromImage":if(!e[a].imageUrl)throw new Error("Masked Points Transition: State with \'maskedBoxFromImage\' type should have \'imageUrl\' field");self.unprocessedStatesAmount+=1,self.makeImageRequest(e[a],a);break;case"maskedBoxFromMatrix":for(var o={data:e[a].matrix||[],width:e[a].matrixWidth||1,height:e[a].matrixHeight||1,sectors:[]},n=0;n<o.data.length;n++)o.data[n]&&o.sectors.push(n);r=self.posGenerator.generateMaskedBoxVertices(self.pointsCount,e[a],o),self.result.geometries[a]=r;break;default:throw new Error("Masked Points Transition: Unknown points state type. Should be box / maskedBoxFromImage / maskedBoxFromMatrix / rawData.")}self.unprocessedStatesAmount<1&&self.exit()},self.addEventListener("message",function(e){e.data.states&&e.data.pointsCount&&self.startCreation(e.data.states,e.data.pointsCount)},!1),self.addEventListener("error",function(e){self.postMessage(e,"error in webworker")},!1)},function(e,t){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,r,a){return r&&e(t.prototype,r),a&&e(t,a),t}}(),o=function(){function e(){r(this,e)}return a(e,[{key:"parsePBMBinaryImage",value:function(e){var t=new Uint8Array(e),r=t.toString(),a=r.split(","),o=!1,n=!1,s=!1,i=!1,f=void 0,l=void 0;for(f=0;f<a.length;f++)if("10"===a[f])i=!1;else if(!i)if("35"===a[f])i=!0;else if(o){if(n)break;n=0,s=0;var u=void 0;for(l=0;"32"!==a[f];){if(u=parseInt(String.fromCharCode(a[f]),10),l>4||isNaN(u))throw new Error("Corrupted PBM image (image width / height data).");n=10*n+u,f++,l++}for("32"===a[f]&&f++,l=0;"10"!==a[f];){if(u=parseInt(String.fromCharCode(a[f]),10),l>4||isNaN(u))throw new Error("Corrupted PBM image (image width / height data).");s=10*s+u,f++,l++}}else{if("80"!==a[f]||"52"!==a[f+1])throw new Error("Wrong image format. Should be PBM binary (with P4 header).");o=!0,f++}var d=f,c=a.length-d,h=new Array(n*s),m=void 0,g=0,p=0;for(f=0;f<c;f++){g+=8;var w=parseInt(a[f+d],10);if(g<n)for(l=0;l<8;l++)h[p*n+g-l-1]=w%2,w=Math.floor(w/2);else{for(g-=8,m=n-g,l=0;l<8;l++)l>=8-m&&(h[p*n+g+8-l-1]=w%2),w=Math.floor(w/2);g=0,p++}}return{data:h,width:n,height:s}}}]),e}();t.default=o},function(e,t){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,r,a){return r&&e(t.prototype,r),a&&e(t,a),t}}(),o=function(){function e(){r(this,e)}return a(e,[{key:"generateBoxVertices",value:function(e,t){for(var r=t.width||10,a=t.height||10,o=t.depth||10,n=t.zDistance||5,s=new Array(3*e),i=0;i<3*e;i+=3)s[i]=Math.random()*r-r/2,s[i+1]=Math.random()*a-a/2,s[i+2]=-Math.random()*o-1+(5-n);return new Float32Array(s)}},{key:"generateMaskedBoxVertices",value:function(e,t,r){for(var a=t.width||10,o=t.height||10,n=t.depth||10,s=t.zDistance||5,i=r.width,f=r.height,l=r.sectors,u=void 0,d=void 0,c=new Array(3*e),h=void 0,m=0;m<3*e;m+=3)h=m/3%l.length,d=1-(Math.floor(l[h]/i)+Math.random())/f,u=(l[h]%i+Math.random())/i,c[m]=u*a-a/2,c[m+1]=d*o-o/2,c[m+2]=-Math.random()*n-1+(5-s);return new Float32Array(c)}}]),e}();t.default=o}]);',r.p+"4bcb06cf338f7a4856ad.worker.js")}},function(e,t){var r=window.URL||window.webkitURL;e.exports=function(e,t){try{try{var i;try{var n=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder;i=new n,i.append(e),i=i.getBlob()}catch(t){i=new Blob([e])}return new Worker(r.createObjectURL(i))}catch(t){return new Worker("data:application/javascript,"+encodeURIComponent(e))}}catch(e){return new Worker(t)}}}]);