!function(e){function t(r){if(i[r])return i[r].exports;var n=i[r]={exports:{},id:r,loaded:!1};return e[r].call(n.exports,n,n.exports,t),n.loaded=!0,n.exports}var i={};return t.m=e,t.c=i,t.p="",t(0)}([function(e,t,i){e.exports=i(1)},function(e,t,i){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var a=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),o=i(2),s=r(o),h=i(5),u=null,c=void 0,l=void 0,d=void 0,f=0,g=window.devicePixelRatio||1,v=void 0,m=function(){function e(){return n(this,e),v=this,c=document.getElementById("canvas"),(u=h(c))?(this.initGlState(),this.makeImageRequest("https://mlknz.github.io/Masked-Points-Transition/assets/images/test4.pbm"),void this.animate()):void(document.body.innerHTML="Unable to initialize WebGL. Your browser may not support it.")}return a(e,[{key:"initGlState",value:function(){u.clearColor(0,0,0,1),u.enable(u.BLEND),u.blendFunc(u.ONE,u.ONE)}},{key:"resize",value:function(){l=Math.floor(c.clientWidth*g),d=Math.floor(c.clientHeight*g),c.width===l&&c.height===d||(c.width=l,c.height=d,this.points&&this.points.resize()),u.viewport(0,0,u.canvas.width,u.canvas.height)}},{key:"animate",value:function(){v.resize(),u.clear(u.COLOR_BUFFER_BIT|u.DEPTH_BUFFER_BIT),f=(new Date).getTime(),f=(f-1e6*Math.floor(f/1e6))/1e3,v.points&&(u.useProgram(v.points.shaderProgram),v.points.update(f),v.points.render()),requestAnimationFrame(v.animate)}},{key:"makeImageRequest",value:function(e){var t=new XMLHttpRequest;t.open("GET",e,!0),t.responseType="arraybuffer",t.onreadystatechange=function(){if(4===t.readyState&&200===t.status){var e=v.parsePBMBinaryImage(t.response);e.sectors=[];for(var i=0;i<e.data.length;i++)e.data[i]&&e.sectors.push(i);v.points=new s.default(u,e)}},t.send()}},{key:"parsePBMBinaryImage",value:function(e){var t=new Uint8Array(e),i=t.toString(),r=i.split(","),n=!1,a=!1,o=!1,s=!1,h=void 0,u=void 0;for(h=0;h<r.length;h++)if("10"===r[h])s=!1;else if(!s)if("35"===r[h])s=!0;else if(n){if(a)break;a=0,o=0;var c=void 0;for(u=0;"32"!==r[h];){if(c=parseInt(String.fromCharCode(r[h]),10),u>4||isNaN(c))throw new Error("Corrupted PBM image (image width / height data).");a=10*a+c,h++,u++}for("32"===r[h]&&h++,u=0;"10"!==r[h];){if(c=parseInt(String.fromCharCode(r[h]),10),u>4||isNaN(c))throw new Error("Corrupted PBM image (image width / height data).");o=10*o+c,h++,u++}}else{if("80"!==r[h]||"52"!==r[h+1])throw new Error("Wrong image format. Should be PBM binary (with P4 header).");n=!0,h++}var l=h,d=r.length-l,f=new Array(a*o),g=void 0,v=0,m=0;for(h=0;h<d;h++){v+=8;var p=parseInt(r[h+l],10);if(v<a)for(u=0;u<8;u++)f[m*a+v-u-1]=p%2,p=Math.floor(p/2);else{for(v-=8,g=a-v,u=0;u<8;u++)u>=8-g&&(f[m*a+v+8-u-1]=p%2),p=Math.floor(p/2);v=0,m++}}return{data:f,width:a,height:o}}}]),e}();window.app=new m},function(e,t,i){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),o=i(3),s=r(o),h=i(4),u=r(h),c=void 0,l=void 0,d=void 0,f=void 0,g=void 0,v=8500,m=function(){function e(t,i){var r=this;n(this,e),this.gl=t,this.n=v;var a=this.generateVerticesWithoutMask(this.n),o=this.generateVerticesFromMask(this.n,i),s=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,s),t.bufferData(t.ARRAY_BUFFER,new Float32Array(a.concat(o)),t.STATIC_DRAW),this.shaderProgram=this.createShaderProgram(t);var h=t.getAttribLocation(this.shaderProgram,"position"),u=t.getAttribLocation(this.shaderProgram,"newPosition");t.vertexAttribPointer(h,3,t.FLOAT,!1,0,0),t.vertexAttribPointer(u,3,t.FLOAT,!1,0,4*a.length),t.enableVertexAttribArray(h),t.enableVertexAttribArray(u),this.viewMatrix=mat4.create(),this.perpectiveMatrix=mat4.create(),this.eyePos=vec3.fromValues(0,0,0),this.eyeTargetPos=vec3.fromValues(0,0,-2),this.up=vec3.fromValues(0,1,0),f=this.gl.getUniformLocation(this.shaderProgram,"perspectiveMatrix"),d=this.gl.getUniformLocation(this.shaderProgram,"viewMatrix"),g=this.gl.getUniformLocation(this.shaderProgram,"time"),t.useProgram(this.shaderProgram),this.updateView({clientX:window.innerWidth/2,clientY:window.innerHeight/2}),this.resize(),document.addEventListener("mousemove",function(e){r.updateView(e)})}return a(e,[{key:"generateVerticesWithoutMask",value:function(e){for(var t=new Array(3*e),i=0;i<3*e;i+=3)t[i]=10*Math.random()-5,t[i+1]=10*Math.random()-5,t[i+2]=10*-Math.random()-1;return t}},{key:"generateVerticesFromMask",value:function(e,t){for(var i=t.width,r=t.height,n=t.sectors,a=void 0,o=void 0,s=new Array(3*e),h=void 0,u=0;u<3*e;u+=3)h=u/3%n.length,o=1-(Math.floor(n[h]/i)+Math.random())/r,a=(n[h]%i+Math.random())/i,s[u]=10*a-5,s[u+1]=10*o-5,s[u+2]=-8;return s}},{key:"resize",value:function(){this.gl.useProgram(this.shaderProgram),mat4.perspective(this.perpectiveMatrix,1,window.innerWidth/window.innerHeight,.5,21.1),this.gl.uniformMatrix4fv(f,!1,this.perpectiveMatrix)}},{key:"updateView",value:function(e){c=e.clientX/window.innerWidth,l=e.clientY/window.innerHeight,this.eyePos[0]=.3*-(c-.5),this.eyePos[1]=.3*+(l-.5),mat4.lookAt(this.viewMatrix,this.eyePos,this.eyeTargetPos,this.up),this.gl.uniformMatrix4fv(d,!1,this.viewMatrix)}},{key:"createShaderProgram",value:function(e){var t=e.createShader(e.VERTEX_SHADER);e.shaderSource(t,s.default),e.compileShader(t);var i=e.createShader(e.FRAGMENT_SHADER);e.shaderSource(i,u.default),e.compileShader(i);var r=e.createProgram();return e.attachShader(r,t),e.attachShader(r,i),e.linkProgram(r),r}},{key:"update",value:function(e){this.gl.uniform1f(g,e)}},{key:"render",value:function(){this.gl.drawArrays(this.gl.POINTS,0,this.n)}}]),e}();t.default=m},function(e,t){e.exports="attribute vec3 position;\nattribute vec3 newPosition;\n\nuniform mat4 viewMatrix;\nuniform mat4 perspectiveMatrix;\n\nuniform float time;\n\nvarying float dist;\n\nvoid main() {\n\n    vec3 pos = mix(position, newPosition, sin(time)*0.5 + 0.5);\n    dist = (-pos.z - 1.) / 10.; // [0, 1]\n\n    gl_Position = perspectiveMatrix * viewMatrix * vec4(pos, 1.0);\n    gl_PointSize = mix(10.0, 5.0, dist);\n}\n"},function(e,t){e.exports="precision highp float;\n\nvarying float dist;\n\nvoid main() {\n\n    vec2 coord = gl_PointCoord - vec2(0.5);\n    float inCircle = 1. - smoothstep(0.495, 0.500, length(coord));\n    // if (length(coord) > 0.5) inCircle = 0.;\n    if (inCircle < 0.95) discard;\n    gl_FragColor = vec4(mix(0., 1. - dist, inCircle));\n    gl_FragColor.a = mix(1., 1. - dist, inCircle);\n}\n"},function(e,t){"use strict";e.exports=function(e){if(window.WebGLRenderingContext){for(var t=["webgl","experimental-webgl","moz-webgl"],i=!1,r=0;r<t.length;r++)try{if(i=e.getContext(t[r]),i&&"function"==typeof i.getParameter)return i}catch(e){console.log("Unable to initialize WebGL. Your browser may not support it.")}return!1}return!1}}]);