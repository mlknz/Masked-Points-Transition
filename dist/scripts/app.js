!function(e){function t(r){if(i[r])return i[r].exports;var n=i[r]={exports:{},id:r,loaded:!1};return e[r].call(n.exports,n,n.exports,t),n.loaded=!0,n.exports}var i={};return t.m=e,t.c=i,t.p="",t(0)}([function(e,t,i){e.exports=i(1)},function(e,t,i){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var o=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),a=i(2),s=r(a),c=i(5),u=i(6),h=null,l=void 0,d=void 0,f=void 0,p=0,g=void 0,v=window.devicePixelRatio||1,m={pointsCount:1500,pointSizeMin:5,pointSizeMax:10,backgroundColor:[0,0,0,1],pointsColor:[1,1,1],states:[{type:"box",width:10,height:10,depth:10,zDistance:5},{type:"box",width:10,height:10,depth:10,zDistance:5},{type:"box",width:50,height:50,depth:1,zDistance:-1},{type:"maskedBoxFromImage",imageUrl:"https://mlknz.github.io/Masked-Points-Transition/assets/images/test4.pbm",width:10,height:10,depth:.1,zDistance:12},{type:"maskedBoxFromMatrix",matrix:[1,1,1,0,0,1,1,0,1],matrixWidth:3,matrixHeight:3,width:10,height:10,depth:.1,zDistance:12}]},w=function(){function e(){if(n(this,e),g=this,l=document.getElementById("canvas"),h=c(l),!h)return void(document.body.innerHTML="Unable to initialize WebGL. Your browser may not support it.");this.initGlState();var t=new u;t.addEventListener("error",function(e){console.warn("Error in webworker: ",e.data)},!1),t.addEventListener("message",function(e){e.data.geometries&&(g.points=new s.default(h,e.data.geometries,m),g.points.setPositionIndices(4,2))},!1),t.postMessage(m),this.animate()}return o(e,[{key:"initGlState",value:function(){var e=m.backgroundColor;h.clearColor(e[0],e[1],e[2],e[3]),h.enable(h.BLEND),h.blendFunc(h.ONE,h.ONE)}},{key:"resize",value:function(){d=Math.floor(l.clientWidth*v),f=Math.floor(l.clientHeight*v),l.width===d&&l.height===f||(l.width=d,l.height=f,this.points&&this.points.resize()),h.viewport(0,0,h.canvas.width,h.canvas.height)}},{key:"animate",value:function(){g.resize(),h.clear(h.COLOR_BUFFER_BIT|h.DEPTH_BUFFER_BIT),p=(new Date).getTime(),p=(p-1e6*Math.floor(p/1e6))/1e3,g.points&&(h.useProgram(g.points.shaderProgram),g.points.updateProgress(p),g.points.render()),requestAnimationFrame(g.animate)}}]),e}();window.app=new w},function(e,t,i){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),a=i(3),s=r(a),c=i(4),u=r(c),h=void 0,l=void 0,d=void 0,f=void 0,p=void 0,g=void 0,v=function(){function e(t,i,r){var o=this;n(this,e),this.gl=t,this.n=r.pointsCount,this.positions=i,p=t.createBuffer(),g=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,p),t.bufferData(t.ARRAY_BUFFER,this.positions[0],t.STATIC_DRAW),t.bindBuffer(t.ARRAY_BUFFER,g),t.bufferData(t.ARRAY_BUFFER,this.positions[0],t.STATIC_DRAW),t.bindBuffer(t.ARRAY_BUFFER,null),this.shaderProgram=this.createShaderProgram(t);var a=t.getAttribLocation(this.shaderProgram,"position"),s=t.getAttribLocation(this.shaderProgram,"newPosition");t.bindBuffer(t.ARRAY_BUFFER,p),t.vertexAttribPointer(a,3,t.FLOAT,!1,0,0),t.enableVertexAttribArray(a),t.bindBuffer(t.ARRAY_BUFFER,g),t.vertexAttribPointer(s,3,t.FLOAT,!1,0,0),t.enableVertexAttribArray(s),this.viewMatrix=mat4.create(),this.perpectiveMatrix=mat4.create(),this.viewPerspectiveMatrix=mat4.create(),this.eyePos=vec3.fromValues(0,0,0),this.eyeTargetPos=vec3.fromValues(0,0,-2),this.up=vec3.fromValues(0,1,0),d=this.gl.getUniformLocation(this.shaderProgram,"viewPerspectiveMatrix"),f=this.gl.getUniformLocation(this.shaderProgram,"progress"),t.useProgram(this.shaderProgram);var c=this.gl.getUniformLocation(this.shaderProgram,"pointSizeMinMax");this.gl.uniform2f(c,r.pointSizeMin,r.pointSizeMax);var u=this.gl.getUniformLocation(this.shaderProgram,"color");this.gl.uniform3f(u,r.pointsColor[0],r.pointsColor[1],r.pointsColor[2]),this.updateView({clientX:window.innerWidth/2,clientY:window.innerHeight/2}),this.resize(),document.addEventListener("mousemove",function(e){o.updateView(e)})}return o(e,[{key:"setPositionIndices",value:function(e,t){var i=e,r=t,n=this.gl;this.positions[i]&&this.positions[r]||(i=0,r=0),n.bindBuffer(n.ARRAY_BUFFER,p),n.bufferData(n.ARRAY_BUFFER,this.positions[i],n.STATIC_DRAW),n.bindBuffer(n.ARRAY_BUFFER,g),n.bufferData(n.ARRAY_BUFFER,this.positions[r],n.STATIC_DRAW),n.bindBuffer(n.ARRAY_BUFFER,null)}},{key:"resize",value:function(){this.gl.useProgram(this.shaderProgram),mat4.perspective(this.perpectiveMatrix,1,window.innerWidth/window.innerHeight,.5,21.1),mat4.multiply(this.viewPerspectiveMatrix,this.viewMatrix,this.perpectiveMatrix),this.gl.uniformMatrix4fv(d,!1,this.viewPerspectiveMatrix)}},{key:"updateView",value:function(e){h=e.clientX/window.innerWidth,l=e.clientY/window.innerHeight,this.eyePos[0]=.3*-(h-.5),this.eyePos[1]=.3*+(l-.5),mat4.lookAt(this.viewMatrix,this.eyePos,this.eyeTargetPos,this.up),mat4.multiply(this.viewPerspectiveMatrix,this.viewMatrix,this.perpectiveMatrix),this.gl.uniformMatrix4fv(d,!1,this.viewPerspectiveMatrix)}},{key:"createShaderProgram",value:function(e){var t=e.createShader(e.VERTEX_SHADER);e.shaderSource(t,s.default),e.compileShader(t);var i=e.createShader(e.FRAGMENT_SHADER);e.shaderSource(i,u.default),e.compileShader(i);var r=e.createProgram();return e.attachShader(r,t),e.attachShader(r,i),e.linkProgram(r),r}},{key:"updateProgress",value:function(e){this.gl.uniform1f(f,e)}},{key:"render",value:function(){this.gl.drawArrays(this.gl.POINTS,0,this.n)}}]),e}();t.default=v},function(e,t){e.exports="attribute vec3 position;\nattribute vec3 newPosition;\n\nuniform mat4 viewPerspectiveMatrix;\n\nuniform vec2 pointSizeMinMax;\nuniform float progress;\n\nvarying float dist;\n\nvoid main() {\n\n    vec3 pos = mix(position, newPosition, sin(progress)*0.5 + 0.5);\n    dist = (-pos.z - 1.) / 10.; // [0, 1]\n\n    gl_Position = viewPerspectiveMatrix * vec4(pos, 1.0);\n    gl_PointSize = mix(pointSizeMinMax.y, pointSizeMinMax.x, dist);\n}\n"},function(e,t){e.exports="precision highp float;\n\nuniform vec3 color;\nvarying float dist;\n\nvoid main() {\n\n    vec2 coord = gl_PointCoord - vec2(0.5);\n    float inCircle = 1. - smoothstep(0.495, 0.500, length(coord));\n    // if (length(coord) > 0.5) inCircle = 0.;\n    if (inCircle < 0.95) discard;\n    gl_FragColor = vec4(mix(0., 1. - dist, inCircle));\n\n    gl_FragColor.rgb *= color;\n    gl_FragColor.a = mix(1., 1. - dist, inCircle);\n}\n"},function(e,t){"use strict";e.exports=function(e){if(window.WebGLRenderingContext){for(var t=["webgl","experimental-webgl","moz-webgl"],i=!1,r=0;r<t.length;r++)try{if(i=e.getContext(t[r]),i&&"function"==typeof i.getParameter)return i}catch(e){console.log("Unable to initialize WebGL. Your browser may not support it.")}return!1}return!1}},function(e,t,i){e.exports=function(){return new Worker(i.p+"4bcb06cf338f7a4856ad.worker.js")}}]);